{% extends 'base_dar.html' %}

{% load deputags %}
{% load dartags %}
{% load if_tag %}

{% block extrabodyclass %}default dar{% endblock %}

{% block title %}{{ day.date }} &mdash; Demo.cratica (Beta){% endblock %}

{% block ogtitle %}{{ day.date }} &mdash; Demo.cratica (Beta){% endblock %}
{% block ogurl %}{% url day_detail day.date.year day.date.month day.date.day %}{% endblock %}
{% block ogtype %}transcript{% endblock %}

{% block extrascripts %}
    <script src="/media/js/jquery.jeditable.mini.js" type="text/javascript"></script>
    <script src="https://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript"></script>
    <script type="text/javascript">
      $(document).ready(function(){  
        // CSRF protection
        $.ajaxSetup({
          data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
        });

        $(".entry").hover(function(){
          $(this).toggleClass("active");
        });

        // jeditable
        $(".edit_area").editable("/sessoes/gravar/",
          {
            cancel: "Cancelar",
            submit: "OK",
            tooltip: "Clique 2 vezes para fazer alterações.",
            loadurl  : '/sessoes/raw/',
            type: "textarea",
            event: "dblclick",
            });
      });
    </script>
  
    {% comment %}
      <script type="text/javascript">
        $(document).ready(function(){
          $('li.entry-link').one('click', openMenu);
          function openMenu(e) {
            var button = $(this).addClass('active');
            var menu = $('#popup-' + button.attr('id'));
            menu.addClass('open').click(function(e) {
            e.stopPropagation(); }).show(200, function() {
                $(document).one('click', {button: button, menu: menu}, closeMenu);
              });
            }
          function closeMenu(e) {
            e.data.menu.removeClass('open').hide(100, function() {
              e.data.button.removeClass('active')
            });
            e.data.button.one('click', openMenu);
          }
        });
    </script>
    {% endcomment %}

{% endblock %}

{% block content %}
      <div id="content-box">
        
        <ul id="dar-tabs" class="tabs">
          <li><span>Sessão</span></li>
          <li><a href="stats" title="">Estatísticas</a></li>
        </ul>
         
        <h2 class="ribbon">{{ day.date }}</h2>

        <p><strong>Nota:</strong> As transcrições ainda estão em desenvolvimento. Pode haver inconsistências e erros de processamento.</p>

        {% for entry in entries %}


        {% comment %}
          {# {{ entry.html|safe }} #}
          {% if entry.type == 'deputado_intervencao' %}
          <div class="intervention">
            <div class="entry" id="{{ entry.id }}">
            <!-- Intervencao de deputado - inicio -->
              <div class="left">
                {% with entry.mp as mp %}
                <p class="mp-photo"><a href="/deputados/{{ mp.id }}" class="avatar-colorbar {{ mp.current_party.abbrev|lower }}"><img src="{{ mp.photo.url_60x79 }}" alt="{{ mp.shortname }}" /></a></p>
                <h3 class="mp-name"><a href="/deputados/{{ mp.id }}">{{ mp.shortname }}</a></h3>
                {# {% if mp|get_post_on:gov %} <h4>{{ mp|get_post_on:gov }}</h4> {% endif %} #}
                <p class="party {{ mp.current_party.abbrev|lower }}">{{ mp.current_party.abbrev }}</p>
                <p class="circle {{ mp.current_party.abbrev|lower }}">{{ mp.current_caucus.constituency }}</p>
                {% endwith %}
              </div> <!-- /left -->
              <div class="right edit_area"> {{ entry.text_as_html }} </div> <!-- /right -->
            </div>
          </div>
          {% else %}
          <div class="entry" id="{{ entry.id }}">
            <div class="right edit_area" id="Entry_raw_text_{{ entry.id }}"> {{ entry.raw_text_as_html }} </div>
          </div>
          {% endif %}
        {% endfor %}
        {% endcomment%}


          {{ entry.position }}
          <p><a href="">Reparse</a></p>
          {% if forloop.first %}
          <div class="intervention mini-intervention">
          {% endif %}

          {# Verificar se temos de fechar a tag da intervencao anterior #}
          {% if entry.type == 'deputado_intervencao' or entry.type == 'presidente' or entry.type == 'secretario' or entry.type == 'presidente_temapalavra' or entry.type == 'presidente_aberta' or entry.type == 'pm_intervencao' %}
            </div> <!-- /intervention --> 
            {% if entry.type == 'deputado_intervencao' or entry.type == 'pm_intervencao' or entry.type == 'ministro_intervencao' %}
              <div class="intervention">
            {% else %}
              <div class="intervention mini-intervention">
            {% endif %}
          {% endif %}

          <div class="entry" id="{{ entry.id }}">
            {% include 'dar/entry_snippet.html' %}
          </div> <!-- /entry -->
          {% if forloop.last %}
          </div> <!-- /intervention --> 
          {% endif %}

        {% endfor %}

          
      <p class="notice">Versão Beta: Esta informação pode estar incompleta e/ou conter incorrecções.</p>

      </div><!-- /#content-box -->
{% endblock content %}


