{% extends 'base_dar.html' %}

{% load deputags %}
{% load dartags %}
{% load if_tag %}

{% block extrabodyclass %}default dar{% endblock %}

{% block title %}{{ day.date }} &mdash; Demo.cratica (Beta){% endblock %}

{% block ogtitle %}{{ day.date }} &mdash; Demo.cratica (Beta){% endblock %}
{% block ogurl %}{% url day_detail day.date.year day.date.month day.date.day %}{% endblock %}
{% block ogtype %}transcript{% endblock %}

{% block extrascripts %}
    <script src="/media/js/jquery.jeditable.mini.js" type="text/javascript"></script>
    <script src="https://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript"></script>
    <script type="text/javascript">
      // recarrega uma entrada individual
        function refresh(id) {
          $.ajax({
            url: '/sessoes/reprocessar/' + id,
          success: function(data) {
            $('.entry#' + id).html(data);
          /*
            // precisamos de colocar a textarea como editável novamente
            $(".edit_area#Entry_raw_text_" + id).editable("/sessoes/gravar/",
              {
                cancel: "Cancelar",
                submit: "OK",
                tooltip: "Clique 2 vezes para fazer alterações.",
                loadurl  : '/sessoes/raw/',
                type: "textarea",
                event: "dblclick",
                });
                */
          }
        });
      };

      $(document).ready(function(){  
        // CSRF protection
        $.ajaxSetup({
          data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
        });

        $(".entry").hover(function(){
          $(this).toggleClass("active");
        });

        // jeditable
        $(".edit_area").editable("/sessoes/gravar/",
          {
            cancel: "Cancelar",
            submit: "OK",
            tooltip: "Clique 2 vezes para fazer alterações.",
            loadurl  : '/sessoes/raw/',
            type: "textarea",
            event: "dblclick",
            });

      });
    </script>

{% endblock %}

{% block content %}
      <div id="content-box">
        
        <ul id="dar-tabs" class="tabs">
          <li><span>Sessão</span></li>
          <li><a href="stats" title="">Estatísticas</a></li>
        </ul>
         
        <h2 class="ribbon">{{ day.date }}</h2>

        <p><strong>Nota:</strong> As transcrições ainda estão em desenvolvimento. Pode haver inconsistências e erros de processamento.</p>

        {% for entry in entries %}

          {# Debug info #}
          <p>{{ entry.position }}</p>
          <p><a href="javascript:refresh({{ entry.id }});">Refresh</a></p>

          {% if forloop.first %}
          <div class="intervention mini-intervention">
          {% endif %}

          {# Verificar se temos de fechar a tag da intervencao anterior #}
          {% if entry.type == 'deputado_intervencao' or entry.type == 'presidente' or entry.type == 'secretario' or entry.type == 'presidente_temapalavra' or entry.type == 'presidente_aberta' or entry.type == 'pm_intervencao' %}
            </div> <!-- /intervention --> 
            {% if entry.type == 'deputado_intervencao' or entry.type == 'pm_intervencao' or entry.type == 'ministro_intervencao' %}
              <div class="intervention">
            {% else %}
              <div class="intervention mini-intervention">
            {% endif %}
          {% endif %}

          <div class="entry" id="{{ entry.id }}">
            {% include 'dar/entry_snippet.html' %}
          </div> <!-- /entry -->
          {% if forloop.last %}
          </div> <!-- /intervention --> 
          {% endif %}

        {% endfor %}

          
      <p class="notice">Versão Beta: Esta informação pode estar incompleta e/ou conter incorrecções.</p>

      </div><!-- /#content-box -->
{% endblock content %}


